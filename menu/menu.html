<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="menu.css">
    <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />

    <title>menu</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDImyxdSlB0Yr0PdMx32nVccGt7n3zMWZw",
            authDomain: "gharvedtan-auth.firebaseapp.com",
            projectId: "gharvedtan-auth",
            storageBucket: "gharvedtan-auth.firebasestorage.app",
            messagingSenderId: "32502650170",
            appId: "1:32502650170:web:8268b4c5947d5f04ab6c03"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const searchInput = document.getElementById("searchInput");
        const searchBtn = document.getElementById("searchBtn");
        const catalogue = document.querySelector(".popular-foods__catalogue");

        async function fetchAndDisplayItems(searchTerm = "") {
            catalogue.innerHTML = "Loading...";
            let q = collection(db, "menuItems");

            const querySnapshot = await getDocs(q);
            catalogue.innerHTML = "";

            querySnapshot.forEach(doc => {
                const item = doc.data();
                if (
                    item.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    item.sellerName.toLowerCase().includes(searchTerm.toLowerCase())
                ) {
                    
                    const card = `
                        <article class="popular-foods__card">
                            <img class="popular-foods__card-image" src="${item.photoUrl}" alt="${item.name}" />
                            <h1 class="popular-foods__card-seller">${item.sellerName}</h1>
                            <h4 class="popular-foods__card-title">${item.name}</h4>

                            <div class="popular-foods__card-details flex-between">
                                <div class="popular-foods__card-rating">
                                    <img src="../assets/star.svg" alt="star" />
                                    <p>${item.rating}</p>
                                </div>
                                <p class="popular-foods__card-price">â‚¹${item.price}</p>
                            </div>
                            <div class="subscription__form">
                                <button 
                             class="add-to-cart" 
                             data-id="${item.id}" 
                             data-name="${item.name}" 
                             data-price="${item.price}">
                             Add to Cart
                             </button>

                            </div>
                        </article>
                    `;
                    catalogue.insertAdjacentHTML("beforeend", card);
                }
            });

            
            document.querySelectorAll(".add-to-cart").forEach(button => {
             button.addEventListener("click", () => {
              const id = button.getAttribute("data-id");
              const name = button.getAttribute("data-name");
              const price = parseFloat(button.getAttribute("data-price"));
    
                addToCart(id, name, price);
                });
            });

        }

        document.addEventListener("DOMContentLoaded", () => {
            fetchAndDisplayItems();
            searchBtn.addEventListener("click", () => {
                fetchAndDisplayItems(searchInput.value);
            });
        });
    </script>
</head>

<body>

    <header>
        <nav class="header__nav">
            <div class="header__logo">
                <h4 data-aos="fade-down">Gharvedtan</h4>
                <div class="header__logo-overlay"></div>
            </div>

            <ul class="header__menu" data-aos="fade-down">

                <li>
                    <a href="../index.html">Home</a>
                </li>
                <li>
                    <a href="../loginsignup/work.html">Login</a>
                </li>
                <li>
                    <div class="profile-container">
                        <img src="../assets/profile.svg" alt="profile" class="profile-icon" id="profileIcon" />
                        <div class="dropdown-menu" id="dropdownMenu">
                            <a href="#">My Orders</a>
                            <a href="#">Profile</a>
                            <a href="#">Settings</a>
                            <a href="#">Logout</a>
                        </div>
                    </div>
                </li>
            </ul>

            <ul class="header__menu-mobile" data-aos="fade-down">
                <li>
                    <img src="../assets/menu.svg" alt="menu" />
                </li>
            </ul>
        </nav>
    </header>

    <section class="layer-container">

        <!-- Layer 1: Floral Background -->
        <div class="floral-bg">
            <div class="food-scroll">
                <div class="food-track">
                    <img src="../assets/1 (1).png" alt="food" />
                    <img src="../assets/1 (2).png" alt="food" />
                    <img src="../assets/1 (3).png" alt="food" />
                    <img src="../assets/1 (4).png" alt="food" />
                    <img src="../assets/1 (5).png" alt="food" />
                    <img src="../assets/1 (6).png" alt="food" />
                    <img src="../assets/1 (7).png" alt="food" />
                    <img src="../assets/1 (8).png" alt="food" />
                    <img src="../assets/1 (9).png" alt="food" />
                    <img src="../assets/1 (10).png" alt="food" />
                    <img src="../assets/1 (1).png" alt="food" />
                    <img src="../assets/1 (2).png" alt="food" />
                    <img src="../assets/1 (3).png" alt="food" />
                    <img src="../assets/1 (4).png" alt="food" />
                    <img src="../assets/1 (5).png" alt="food" />
                    <img src="../assets/1 (6).png" alt="food" />
                    <img src="../assets/1 (7).png" alt="food" />
                    <img src="../assets/1 (8).png" alt="food" />
                    <img src="../assets/1 (9).png" alt="food" />
                    <img src="../assets/1 (10).png" alt="food" />
                </div>
            </div>

        </div>
        <div class="info">
            <span>MO&nbsp;&nbsp;&nbsp;D</span>
        </div>

        <!-- Layer 2: Moving Food Items -->


        <div class="smoke"></div>
        <div class="smoke2"></div>
        <div class="signature-text">What's your</div>

    </section>

    <section class="popular-foods" id="menu">
        <div class="subscription__form1" data-aos="fade-up">
            <input id="searchInput" type="text" placeholder="Search for your favourite comfort food" />
            <button id="searchBtn"><img src="../assets/search.svg"></button>
        </div>

        <div class="popular-foods__filters hide-scrollbar" data-aos="fade-up">
            <button class="popular-foods__filter-btn active" data-region="all">All</button>
            <button class="popular-foods__filter-btn" data-region="south">South Indian</button>
            <button class="popular-foods__filter-btn" data-region="north">North Indian</button>
            <button class="popular-foods__filter-btn" data-region="west">West Indian</button>
            <button class="popular-foods__filter-btn" data-region="east">East Indian</button>
        </div>

        <div class="popular-foods__catalogue" data-aos="fade-up">
            <!-- Firebase items will render here -->
        </div>
    </section>

    <footer class="footer flex-between">

        <h3 class="footer__logo">
            <span>GharVED</span>tan
        </h3>

        <ul class="footer__nav">
            <li><a href="#menu">Menu</a></li>
            <li><a href="../addrestaurant.html">Work With Us</a></li>
            <li><a href="#about-us">About Us</a></li>
            <li><a href="#policies">Terms & Conditions</a></li>
        </ul>

        <ul class="footer__social">
            <li class="flex-center">
                <img src="../assets/facebook.svg" alt="facebook" />
            </li>
            <li class="flex-center">
                <img src="../assets/instagram.svg" alt="instagram" />
            </li>
            <li class="flex-center">
                <img src="../assets/twitter.svg" alt="twitter" />
            </li>
        </ul>

    </footer>

    <script type="module" src="./firebase.js"></script>
    <script type="module" src="./menu.js"></script>

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="../js/indexjs.js"></script>
</body>

</html>
